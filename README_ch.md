简体中文 | [English](README_en.md)

# PaddleClasMix

## 简介

针对工业场景下的缺陷分类存在的分类网络鲁棒性不佳的问题进行修改，引入了混合监督多分支的分类网络，提高了分类网络的鲁棒性。


## 动机

由于工业场景下的缺陷图像均存在图像的语义信息不足，缺陷与缺陷之间非常的接近的问题，如果再叠加背景的变动，那么现有的分类方法会存在鲁棒性不佳的问题。具体的表现为训练集和验证集上可以达到不错的效果，但是FeatureMap和缺陷之间存在不一致的问题，同时训练的模型在实际测试时候，会存在严重的不稳定，也就是准确性严重波动，这种波动在采集的图像存在轻微变动的时候更加显著。

## 导致问题的原因

缺陷样本严重缺少语义信息，且缺陷与缺陷之间的差异不是很大，分类网络可能关注到背景区域，而不是缺陷区域，那么背景的轻微变动都会导致分类错误。

## 解决办法

- 采用多分支的网络。增加一个辅助的分割分支，来强制要求分类网络更多的关注到缺陷区域，而非背景区域。

- 采用混合监督方式。为了避免分割标注带来的工作量，采用了混合监督的方式。在训练的时候，只计算有分割标签的分割loss。为了保证每个batch都有分割标签，建议分割标签的比例可以达到20%，至少在10%以上。

- 提升预测时间。为了保证预测时间的不便，分割分支只是在训练的时候使用，预测的时候不进行使用。同时将图像的归一化操作放在模型内部处理。

## 适配的网络
- MobileNetV3。其他的网络都类似，按照MobileNetV3的方式进行修改即可。